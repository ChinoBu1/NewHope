package main;

import java.security.MessageDigest;
import java.util.Arrays;
import java.util.Base64;
import java.util.Locale;
import java.util.logging.*;

public class mainNH {

        public static void main(String[] args) throws Exception {
                Logger logger = Logger.getLogger("mainNH");
                FileHandler fh = new FileHandler("mainNH.log");
                fh.setFormatter(new myformatter());
                logger.addHandler(fh);
                logger.setUseParentHandlers(false);
                NewHope nh;
                int q;
                float r;
                switch (args.length) {
                        case 0:
                                nh = new NewHope();
                                q = 12289;
                                r = 4;
                                break;
                        case 1:
                                q = Integer.parseInt(args[0]);
                                r = 4;
                                nh = new NewHope(q);
                                break;
                        case 2:
                                q = Integer.parseInt(args[0]);
                                nh = new NewHope(q);
                                r = Integer.parseInt(args[1]);
                                break;
                        default:
                                System.err.println("Argumetos erroneos");
                                nh = new NewHope();
                                q = 12289;
                                r = 4;
                                System.exit(0);
                                break;
                }

                logger.info(String.format("Parametros: n = 1024, q = %d f(x) = " + nh.getF() + "\n\n", q));
                long start = System.currentTimeMillis();

                MessageDigest ms = MessageDigest.getInstance("SHA3-256");

                byte[] seed = nh.generateSeed();
                Polynomial m = nh.parseSeed(seed);
                Polynomial sa = nh.generateBinoPol();
                Polynomial ea = nh.generateBinoPol();

                logger.info(m + "\n");
                logger.info(sa + "\n");
                logger.info(ea + "\n");

                Polynomial pa = Polynomial.PolyModInt(
                                Polynomial.PolyModF(
                                                Polynomial.SumPoly(
                                                                Polynomial.MultPoly(m, sa),
                                                                ea),
                                                nh.getF()),
                                nh.getPrime());
                logger.info(pa + "\n");
                logger.info("\n");
                logger.info("\n");

                Polynomial sb = nh.generateBinoPol();
                Polynomial eb1 = nh.generateBinoPol();
                logger.info(sb + "\n");
                logger.info(eb1 + "\n");
                Polynomial Kb = Polynomial.PolyModInt(
                                Polynomial.PolyModF(
                                                Polynomial.SumPoly(
                                                                Polynomial.MultPoly(pa, sb),
                                                                eb1),
                                                nh.getF()),
                                nh.getPrime());

                Polynomial eb = nh.generateBinoPol();
                logger.info(eb + "\n");
                Polynomial pb = Polynomial.PolyModInt(
                                Polynomial.PolyModF(
                                                Polynomial.SumPoly(
                                                                Polynomial.MultPoly(m, sb),
                                                                eb),
                                                nh.getF()),
                                nh.getPrime());

                Polynomial Ka = Polynomial.PolyModInt(
                                Polynomial.PolyModF(
                                                Polynomial.MultPoly(sa, pb),
                                                nh.getF()),
                                nh.getPrime());

                Ka = new Polynomial(new long[] { 2945,
                                5466,
                                9332,
                                11506,
                                3222,
                                10135,
                                7224,
                                2877,
                                7864,
                                9770,
                                2342,
                                1843,
                                7033,
                                1701,
                                3030,
                                558,
                                11995,
                                648,
                                2730,
                                2016,
                                882,
                                9057,
                                11994,
                                1280,
                                2578,
                                4251,
                                10310,
                                10153,
                                11775,
                                1669,
                                10587,
                                2510,
                                3624,
                                11087,
                                10307,
                                4086,
                                4478,
                                235,
                                8595,
                                2747,
                                1235,
                                6832,
                                11869,
                                2731,
                                8223,
                                3882,
                                12225,
                                2378,
                                11521,
                                3406,
                                6249,
                                7613,
                                6292,
                                9440,
                                1257,
                                3815,
                                3175,
                                6923,
                                2490,
                                526,
                                7138,
                                8737,
                                1209,
                                5019,
                                8844,
                                871,
                                1167,
                                11928,
                                8309,
                                2776,
                                8250,
                                9850,
                                9506,
                                129,
                                2999,
                                4130,
                                3897,
                                10967,
                                5361,
                                12133,
                                10045,
                                7494,
                                4766,
                                10800,
                                723,
                                7137,
                                2654,
                                4390,
                                8496,
                                1992,
                                1208,
                                6413,
                                1046,
                                4075,
                                9100,
                                1721,
                                9586,
                                12099,
                                7109,
                                208,
                                11101,
                                9128,
                                47,
                                3229,
                                12031,
                                12138,
                                4813,
                                3173,
                                10255,
                                11485,
                                5750,
                                4443,
                                3042,
                                7718,
                                10367,
                                1312,
                                253,
                                8597,
                                1768,
                                5889,
                                2197,
                                11348,
                                8157,
                                628,
                                11204,
                                1369,
                                10291,
                                11253,
                                1825,
                                1981,
                                9867,
                                9842,
                                6338,
                                9794,
                                495,
                                8676,
                                301,
                                9622,
                                8240,
                                8858,
                                3795,
                                8398,
                                10154,
                                12052,
                                7040,
                                3182,
                                1619,
                                7392,
                                873,
                                1343,
                                12112,
                                10408,
                                732,
                                1822,
                                9550,
                                331,
                                447,
                                8442,
                                9030,
                                6652,
                                2692,
                                5269,
                                4727,
                                7762,
                                191,
                                10044,
                                11499,
                                10890,
                                307,
                                12104,
                                2772,
                                10542,
                                1718,
                                6710,
                                8719,
                                5152,
                                7334,
                                3856,
                                8929,
                                8249,
                                1841,
                                7765,
                                4001,
                                7694,
                                4124,
                                4055,
                                1000,
                                562,
                                3368,
                                11659,
                                6222,
                                2962,
                                11254,
                                5219,
                                3749,
                                2017,
                                3910,
                                2603,
                                9528,
                                1603,
                                6609,
                                12122,
                                3919,
                                344,
                                7415,
                                10388,
                                9064,
                                12191,
                                403,
                                6224,
                                5982,
                                4253,
                                10623,
                                814,
                                3810,
                                8895,
                                7405,
                                7868,
                                11452,
                                4291,
                                7315,
                                7692,
                                1686,
                                34,
                                3341,
                                10610,
                                12233,
                                1061,
                                12207,
                                6961,
                                8637,
                                1054,
                                1211,
                                4955,
                                2771,
                                6385,
                                4409,
                                11105,
                                3468,
                                1572,
                                5072,
                                6406,
                                8577,
                                316,
                                8043,
                                11339,
                                9257,
                                4781,
                                8075,
                                8544,
                                8660,
                                11248,
                                1435,
                                4551,
                                1067,
                                4008,
                                2808,
                                3454,
                                1150,
                                9663,
                                11829,
                                10821,
                                6311,
                                11063,
                                6772,
                                1506,
                                908,
                                2285,
                                9356,
                                9883,
                                7145,
                                2641,
                                8081,
                                8061,
                                11989,
                                9623,
                                8862,
                                11020,
                                9517,
                                521,
                                3183,
                                2080,
                                3432,
                                4670,
                                2502,
                                8115,
                                2832,
                                5791,
                                8152,
                                6302,
                                2852,
                                854,
                                9041,
                                6618,
                                6472,
                                4727,
                                1131,
                                7762,
                                1724,
                                10121,
                                783,
                                9954,
                                3496,
                                6114,
                                7022,
                                11733,
                                7776,
                                11235,
                                8034,
                                1481,
                                3706,
                                9726,
                                6128,
                                1555,
                                10778,
                                6606,
                                6546,
                                6334,
                                6585,
                                9418,
                                9449,
                                1509,
                                11543,
                                7442,
                                2650,
                                2567,
                                1870,
                                6966,
                                6593,
                                1066,
                                3756,
                                1830,
                                6780,
                                5218,
                                8229,
                                10090,
                                264,
                                8035,
                                11902,
                                8729,
                                8228,
                                449,
                                3556,
                                2581,
                                7554,
                                5100,
                                6265,
                                2136,
                                2300,
                                3471,
                                7661,
                                4743,
                                9503,
                                5976,
                                8138,
                                10042,
                                11899,
                                7717,
                                1497,
                                10780,
                                6420,
                                9608,
                                11178,
                                10208,
                                8582,
                                12154,
                                5602,
                                2049,
                                4361,
                                4188,
                                5743,
                                9218,
                                5826,
                                9562,
                                497,
                                3288,
                                8933,
                                8179,
                                6326,
                                5308,
                                3609,
                                1797,
                                10165,
                                5860,
                                9866,
                                9617,
                                5886,
                                7210,
                                11307,
                                8785,
                                9219,
                                868,
                                469,
                                4051,
                                847,
                                3862,
                                6346,
                                11448,
                                7952,
                                9417,
                                9680,
                                11676,
                                5385,
                                10851,
                                5871,
                                240,
                                11769,
                                2668,
                                3562,
                                11213,
                                8629,
                                6410,
                                7535,
                                1968,
                                10751,
                                9790,
                                7423,
                                7741,
                                11856,
                                5596,
                                957,
                                11749,
                                5828,
                                4588,
                                2081,
                                139,
                                11517,
                                2736,
                                3404,
                                8847,
                                9927,
                                3535,
                                11811,
                                3362,
                                2065,
                                113,
                                3834,
                                2868,
                                2945,
                                7998,
                                4009,
                                9486,
                                2136,
                                12200,
                                1214,
                                10614,
                                3677,
                                519,
                                5188,
                                10595,
                                206,
                                8001,
                                4192,
                                5212,
                                1080,
                                4121,
                                7164,
                                11617,
                                2165,
                                3169,
                                5123,
                                9405,
                                2755,
                                3227,
                                4233,
                                9023,
                                7663,
                                10010,
                                10784,
                                1575,
                                9260,
                                7753,
                                10422,
                                11220,
                                10548,
                                8785,
                                8820,
                                11762,
                                1149,
                                10295,
                                5046,
                                3387,
                                5512,
                                7570,
                                4148,
                                1453,
                                4745,
                                6642,
                                8378,
                                11156,
                                5935,
                                6457,
                                1296,
                                47,
                                4420,
                                11716,
                                12039,
                                1792,
                                10962,
                                2183,
                                10978,
                                11872,
                                10206,
                                3643,
                                6781,
                                968,
                                5734,
                                8834,
                                6914,
                                5805,
                                12175,
                                3381,
                                7139,
                                3259,
                                11182,
                                8644,
                                9245,
                                6264,
                                36,
                                6195,
                                7746,
                                2772,
                                10040,
                                8326,
                                9661,
                                10266,
                                1366,
                                4087,
                                9742,
                                10380,
                                6058,
                                10088,
                                8486,
                                4243,
                                3657,
                                3310,
                                3206,
                                962,
                                2427,
                                4867,
                                11518,
                                10020,
                                4956,
                                8492,
                                11354,
                                7052,
                                7190,
                                2633,
                                12227,
                                3657,
                                7901,
                                2326,
                                7056,
                                3046,
                                634,
                                7440,
                                9365,
                                1219,
                                1961,
                                5430,
                                2067,
                                4171,
                                2545,
                                11029,
                                4075,
                                11765,
                                7541,
                                3346,
                                6043,
                                11114,
                                8142,
                                8660,
                                4951,
                                9536,
                                4277,
                                2140,
                                533,
                                9753,
                                7373,
                                2417,
                                11292,
                                10103,
                                5996,
                                3097,
                                8578,
                                3364,
                                11982,
                                8926,
                                8411,
                                1406,
                                5940,
                                1095,
                                271,
                                9157,
                                8302,
                                4104,
                                439,
                                7444,
                                4222,
                                7601,
                                5994,
                                11332,
                                4561,
                                9729,
                                10788,
                                8325,
                                5198,
                                2175,
                                260,
                                8863,
                                9613,
                                2655,
                                7459,
                                5260,
                                5516,
                                6189,
                                9785,
                                6212,
                                10680,
                                2691,
                                498,
                                6629,
                                5301,
                                6812,
                                11802,
                                7425,
                                10462,
                                7454,
                                10473,
                                2755,
                                2557,
                                11545,
                                5588,
                                6032,
                                2146,
                                4859,
                                12017,
                                3597,
                                6163,
                                2622,
                                7378,
                                6859,
                                2901,
                                11577,
                                8524,
                                3066,
                                6539,
                                5194,
                                1481,
                                3804,
                                1499,
                                3065,
                                622,
                                1830,
                                5886,
                                3324,
                                5132,
                                3071,
                                1512,
                                7434,
                                8501,
                                8580,
                                11042,
                                7243,
                                9914,
                                8895,
                                8729,
                                8732,
                                3593,
                                10827,
                                5523,
                                1364,
                                7484,
                                415,
                                2023,
                                3541,
                                10246,
                                7930,
                                11044,
                                9973,
                                188,
                                10796,
                                10359,
                                3304,
                                7219,
                                7390,
                                5821,
                                5744,
                                3562,
                                7730,
                                8860,
                                4464,
                                10075,
                                2539,
                                7149,
                                5167,
                                2497,
                                6093,
                                1842,
                                1870,
                                6182,
                                8137,
                                3452,
                                4650,
                                10682,
                                11107,
                                6026,
                                6570,
                                2041,
                                5096,
                                11014,
                                5545,
                                9777,
                                9440,
                                3152,
                                3367,
                                4594,
                                10954,
                                889,
                                10297,
                                9574,
                                11098,
                                7251,
                                3808,
                                6554,
                                11264,
                                6820,
                                5557,
                                10144,
                                9725,
                                5138,
                                17,
                                9358,
                                12201,
                                12248,
                                6887,
                                8236,
                                2291,
                                2603,
                                9029,
                                3350,
                                7815,
                                6474,
                                1685,
                                4921,
                                2947,
                                2051,
                                8072,
                                2289,
                                9072,
                                4998,
                                10913,
                                3821,
                                6355,
                                8624,
                                10538,
                                7933,
                                10830,
                                270,
                                4809,
                                3531,
                                11381,
                                8432,
                                1036,
                                8640,
                                8686,
                                7631,
                                6575,
                                852,
                                8159,
                                8066,
                                5102,
                                11859,
                                2311,
                                4778,
                                2049,
                                88,
                                5402,
                                3314,
                                1163,
                                4742,
                                8474,
                                7297,
                                6018,
                                10566,
                                3357,
                                11567,
                                11494,
                                6834,
                                3192,
                                1426,
                                5177,
                                1657,
                                10401,
                                9788,
                                8932,
                                12069,
                                3352,
                                6958,
                                7565,
                                4861,
                                524,
                                7780,
                                7239,
                                8506,
                                4183,
                                11660,
                                7072,
                                4992,
                                2634,
                                3493,
                                4176,
                                7372,
                                6117,
                                7624,
                                10788,
                                4987,
                                2062,
                                2153,
                                3786,
                                251,
                                8159,
                                8350,
                                1904,
                                11618,
                                11358,
                                10886,
                                12276,
                                2884,
                                10773,
                                1943,
                                5672,
                                1730,
                                9242,
                                8636,
                                2795,
                                9484,
                                4208,
                                9074,
                                4068,
                                5539,
                                2605,
                                839,
                                3125,
                                3652,
                                3315,
                                5719,
                                7109,
                                7412,
                                9909,
                                8787,
                                8871,
                                9125,
                                11676,
                                5792,
                                4663,
                                8944,
                                4843,
                                11067,
                                7916,
                                1213,
                                1842,
                                5154,
                                4658,
                                4156,
                                12252,
                                2440,
                                283,
                                10786,
                                6045,
                                4357,
                                7442,
                                4775,
                                2805,
                                11171,
                                76,
                                4040,
                                7127,
                                3795,
                                8078,
                                12269,
                                11428,
                                12113,
                                7060,
                                3078,
                                9225,
                                4145,
                                4567,
                                6723,
                                131,
                                11566,
                                7462,
                                9298,
                                5755,
                                10330,
                                1620,
                                9980,
                                938,
                                2149,
                                2742,
                                5128,
                                11821,
                                4090,
                                11862,
                                10013,
                                1123,
                                11851,
                                11684,
                                9418,
                                1763,
                                552,
                                768,
                                10428,
                                1386,
                                2144,
                                9119,
                                8343,
                                9426,
                                3641,
                                6261,
                                6826,
                                487,
                                6718,
                                528,
                                5317,
                                5171,
                                5532,
                                3439,
                                12261,
                                9155,
                                2953,
                                8834,
                                8469,
                                1146,
                                9150,
                                8316,
                                7654,
                                6866,
                                10394,
                                6626,
                                1420,
                                11508,
                                7955,
                                7540,
                                6062,
                                3361,
                                6429,
                                5248,
                                2005,
                                3553,
                                7002,
                                4406,
                                2284,
                                2568,
                                5261,
                                3032,
                                3113,
                                5536,
                                1708,
                                10394,
                                1192,
                                4041,
                                10724,
                                194,
                                7244,
                                9733,
                                2997,
                                7311,
                                8600,
                                4162,
                                309,
                                168,
                                2844,
                                928,
                                7433,
                                8552,
                                6995,
                                3726,
                                4751,
                                812,
                                4079,
                                8849,
                                967,
                                7057,
                                10352,
                                7989,
                                7183,
                                6161,
                                9032,
                                10176,
                                3663,
                                3575,
                                6330,
                                7597,
                                4681,
                                4140,
                                6681,
                                7744,
                                1161,
                                931,
                                9851,
                                676,
                                3967,
                                7784,
                                4334,
                                2040,
                                1744,
                                10783,
                                3036,
                                8197,
                                10794,
                                2569,
                                6400,
                                7325,
                                3522,
                                4275,
                                7307,
                                6258,
                                705,
                                3352,
                                7414,
                                3831,
                                4507,
                                2195 });
                Kb = new Polynomial(new long[] { 3217,
                                5561,
                                9814,
                                10942,
                                3171,
                                10034,
                                7373,
                                3301,
                                8124,
                                9489,
                                2522,
                                2100,
                                7331,
                                1433,
                                2783,
                                393,
                                12044,
                                366,
                                3173,
                                2060,
                                642,
                                9139,
                                11779,
                                1762,
                                2962,
                                4130,
                                10017,
                                9457,
                                11584,
                                1779,
                                9991,
                                2104,
                                3690,
                                11647,
                                10883,
                                3467,
                                3923,
                                556,
                                8520,
                                3198,
                                1064,
                                6527,
                                11912,
                                2791,
                                7719,
                                4294,
                                12204,
                                1997,
                                12111,
                                3413,
                                6661,
                                8100,
                                6434,
                                9343,
                                614,
                                3736,
                                2872,
                                6546,
                                2267,
                                11958,
                                7011,
                                8373,
                                1752,
                                5070,
                                8181,
                                646,
                                1333,
                                11733,
                                8465,
                                2457,
                                8231,
                                9889,
                                10048,
                                77,
                                2982,
                                4368,
                                4019,
                                10852,
                                5247,
                                158,
                                10456,
                                7312,
                                4535,
                                10559,
                                1041,
                                6765,
                                2488,
                                4432,
                                8325,
                                2308,
                                1144,
                                6522,
                                1039,
                                4363,
                                8917,
                                2034,
                                9747,
                                11885,
                                7048,
                                11786,
                                10879,
                                8809,
                                11714,
                                3072,
                                12102,
                                191,
                                4823,
                                2901,
                                10177,
                                11097,
                                5399,
                                4468,
                                2883,
                                8506,
                                10622,
                                1632,
                                373,
                                8871,
                                1930,
                                6022,
                                2236,
                                11607,
                                8546,
                                1099,
                                10667,
                                1470,
                                9782,
                                11400,
                                1135,
                                1954,
                                9870,
                                10058,
                                6120,
                                10273,
                                647,
                                7802,
                                401,
                                9848,
                                8212,
                                9021,
                                3867,
                                8060,
                                10302,
                                12102,
                                7124,
                                2146,
                                1628,
                                6930,
                                1067,
                                1734,
                                12167,
                                10528,
                                572,
                                2407,
                                9054,
                                315,
                                535,
                                8882,
                                8665,
                                6031,
                                3486,
                                4498,
                                4664,
                                7352,
                                675,
                                9559,
                                11198,
                                10688,
                                153,
                                208,
                                2650,
                                10054,
                                1786,
                                7152,
                                9055,
                                5142,
                                7482,
                                3480,
                                8523,
                                8004,
                                1996,
                                8207,
                                3899,
                                7391,
                                3887,
                                4167,
                                1174,
                                1146,
                                3431,
                                11716,
                                5710,
                                2967,
                                11192,
                                4984,
                                3555,
                                1716,
                                4090,
                                2807,
                                10155,
                                1615,
                                5622,
                                12121,
                                3734,
                                645,
                                7362,
                                10935,
                                8938,
                                12182,
                                12112,
                                6211,
                                6319,
                                3646,
                                10838,
                                1172,
                                3560,
                                9078,
                                7257,
                                8268,
                                11398,
                                4538,
                                7897,
                                7665,
                                1993,
                                11901,
                                2867,
                                10780,
                                375,
                                358,
                                194,
                                7014,
                                8866,
                                666,
                                808,
                                5127,
                                2624,
                                6640,
                                4764,
                                10470,
                                3721,
                                1943,
                                5163,
                                6810,
                                8540,
                                604,
                                7505,
                                11046,
                                9640,
                                3875,
                                8029,
                                8835,
                                8757,
                                11036,
                                871,
                                3839,
                                1506,
                                3960,
                                2190,
                                3628,
                                1103,
                                9576,
                                11823,
                                10774,
                                6244,
                                10890,
                                6891,
                                1308,
                                1227,
                                2328,
                                9583,
                                9716,
                                7127,
                                2882,
                                8481,
                                8261,
                                59,
                                9421,
                                8972,
                                11112,
                                9462,
                                399,
                                3626,
                                2506,
                                2945,
                                4640,
                                2623,
                                7699,
                                2881,
                                6031,
                                7905,
                                6459,
                                2704,
                                115,
                                8602,
                                6505,
                                6103,
                                4959,
                                812,
                                7992,
                                2063,
                                9303,
                                536,
                                11091,
                                3825,
                                5343,
                                7108,
                                11646,
                                7584,
                                11709,
                                8262,
                                784,
                                3759,
                                9530,
                                6407,
                                2314,
                                10908,
                                7322,
                                6077,
                                5839,
                                6874,
                                9408,
                                9257,
                                1355,
                                11738,
                                7267,
                                2502,
                                2911,
                                2190,
                                7125,
                                6654,
                                801,
                                4070,
                                1873,
                                6232,
                                5441,
                                8066,
                                10614,
                                11950,
                                8089,
                                11501,
                                9071,
                                7920,
                                373,
                                4532,
                                2378,
                                7798,
                                5560,
                                5884,
                                2286,
                                2118,
                                3757,
                                7814,
                                4474,
                                9327,
                                6010,
                                9065,
                                9980,
                                11660,
                                7136,
                                1529,
                                11517,
                                6917,
                                9809,
                                10754,
                                10151,
                                7864,
                                12001,
                                5519,
                                1908,
                                4603,
                                4080,
                                6075,
                                9374,
                                5888,
                                9692,
                                935,
                                2965,
                                9132,
                                8225,
                                6379,
                                4766,
                                3831,
                                2401,
                                10292,
                                6072,
                                9899,
                                8964,
                                5787,
                                7250,
                                10784,
                                9038,
                                9604,
                                1211,
                                481,
                                3581,
                                877,
                                3121,
                                6516,
                                11140,
                                7519,
                                9698,
                                9691,
                                11954,
                                5709,
                                10816,
                                6600,
                                997,
                                12074,
                                1803,
                                3491,
                                11236,
                                8195,
                                6855,
                                7789,
                                1424,
                                10798,
                                10095,
                                6831,
                                7184,
                                12095,
                                5903,
                                556,
                                11924,
                                5429,
                                5058,
                                2603,
                                398,
                                11561,
                                2439,
                                3244,
                                8821,
                                10076,
                                3914,
                                11675,
                                3352,
                                2065,
                                701,
                                4052,
                                2644,
                                2432,
                                7704,
                                3834,
                                9432,
                                2557,
                                12142,
                                1695,
                                10535,
                                4040,
                                570,
                                5367,
                                10368,
                                1,
                                8551,
                                4408,
                                4896,
                                1075,
                                3282,
                                7373,
                                11141,
                                2674,
                                2993,
                                5246,
                                9052,
                                2659,
                                2693,
                                3903,
                                9008,
                                7580,
                                9993,
                                10429,
                                1972,
                                9411,
                                7861,
                                10531,
                                11522,
                                10163,
                                8854,
                                8550,
                                11734,
                                1140,
                                10247,
                                4548,
                                3314,
                                5603,
                                6860,
                                3548,
                                1577,
                                4771,
                                6959,
                                7739,
                                11012,
                                6082,
                                6952,
                                1106,
                                11922,
                                4772,
                                11230,
                                11473,
                                1808,
                                11419,
                                2058,
                                11501,
                                12016,
                                9844,
                                3853,
                                6283,
                                311,
                                5823,
                                9074,
                                7059,
                                5826,
                                12000,
                                3214,
                                6732,
                                2495,
                                10919,
                                8432,
                                9816,
                                5482,
                                149,
                                6182,
                                7769,
                                3052,
                                9809,
                                8002,
                                9552,
                                9629,
                                995,
                                4241,
                                9657,
                                10257,
                                5865,
                                9635,
                                8657,
                                4043,
                                3338,
                                3403,
                                3495,
                                680,
                                2073,
                                5469,
                                12232,
                                10394,
                                4790,
                                7767,
                                12002,
                                6864,
                                7278,
                                2812,
                                61,
                                3582,
                                8689,
                                1609,
                                6846,
                                2588,
                                666,
                                7746,
                                9216,
                                1310,
                                1474,
                                4814,
                                2201,
                                4002,
                                2930,
                                10475,
                                3522,
                                11560,
                                7021,
                                3687,
                                6049,
                                10781,
                                8327,
                                8498,
                                4350,
                                9590,
                                4429,
                                2466,
                                1071,
                                9694,
                                6810,
                                2214,
                                10823,
                                9597,
                                6194,
                                3421,
                                8618,
                                3516,
                                11997,
                                8629,
                                8873,
                                1362,
                                6148,
                                1319,
                                404,
                                8949,
                                8609,
                                4334,
                                13,
                                7165,
                                4422,
                                7955,
                                5783,
                                11331,
                                3907,
                                9578,
                                10463,
                                8410,
                                5490,
                                2253,
                                211,
                                9065,
                                9747,
                                2644,
                                7583,
                                4831,
                                5380,
                                5762,
                                10195,
                                7180,
                                10516,
                                2439,
                                463,
                                5991,
                                5401,
                                7307,
                                12008,
                                7192,
                                10112,
                                7483,
                                10324,
                                2678,
                                1999,
                                11363,
                                5891,
                                5738,
                                1280,
                                4773,
                                12002,
                                3189,
                                6397,
                                2778,
                                7498,
                                7029,
                                3553,
                                11525,
                                8519,
                                3755,
                                6646,
                                5058,
                                1782,
                                3860,
                                1227,
                                2892,
                                649,
                                1809,
                                5755,
                                3972,
                                5149,
                                3513,
                                1489,
                                7110,
                                8302,
                                9056,
                                10834,
                                7557,
                                9996,
                                9038,
                                8258,
                                8281,
                                3234,
                                11002,
                                5627,
                                1157,
                                7439,
                                11984,
                                2452,
                                3828,
                                9810,
                                7741,
                                10691,
                                9542,
                                116,
                                10777,
                                10437,
                                3680,
                                6807,
                                6940,
                                6234,
                                5799,
                                2917,
                                7647,
                                9155,
                                4113,
                                10556,
                                2564,
                                6358,
                                5058,
                                2286,
                                6090,
                                1452,
                                2278,
                                6868,
                                8051,
                                3615,
                                5032,
                                10562,
                                11307,
                                6203,
                                6474,
                                1949,
                                5256,
                                10644,
                                5635,
                                9753,
                                9730,
                                2844,
                                3556,
                                4798,
                                10876,
                                903,
                                10084,
                                9422,
                                10904,
                                7040,
                                3255,
                                6167,
                                11538,
                                7321,
                                5321,
                                9739,
                                9304,
                                5055,
                                284,
                                9410,
                                241,
                                12033,
                                6271,
                                8758,
                                2280,
                                2430,
                                8843,
                                3473,
                                7912,
                                5762,
                                1906,
                                4501,
                                2902,
                                2026,
                                7783,
                                2666,
                                9188,
                                4936,
                                10088,
                                4001,
                                6573,
                                8434,
                                10576,
                                7491,
                                11165,
                                334,
                                5100,
                                3571,
                                11269,
                                8406,
                                1060,
                                8859,
                                8310,
                                8288,
                                7373,
                                886,
                                8359,
                                8175,
                                5584,
                                12222,
                                2373,
                                4205,
                                2750,
                                530,
                                5549,
                                3547,
                                749,
                                5183,
                                8254,
                                6885,
                                5835,
                                10242,
                                3160,
                                11677,
                                11988,
                                6725,
                                3543,
                                943,
                                4891,
                                1387,
                                10045,
                                10133,
                                9248,
                                82,
                                3607,
                                6793,
                                7491,
                                4230,
                                787,
                                7992,
                                6843,
                                8283,
                                4129,
                                11231,
                                7591,
                                4709,
                                2112,
                                3422,
                                4388,
                                7167,
                                6638,
                                7903,
                                10826,
                                4752,
                                1834,
                                2491,
                                3485,
                                112,
                                8086,
                                7997,
                                1900,
                                11664,
                                11371,
                                10449,
                                12034,
                                3013,
                                10855,
                                1999,
                                6000,
                                1375,
                                9165,
                                8713,
                                3000,
                                9829,
                                4615,
                                8874,
                                4126,
                                5299,
                                1715,
                                1094,
                                2910,
                                3806,
                                3213,
                                5134,
                                7020,
                                7517,
                                9692,
                                8538,
                                8930,
                                9487,
                                11804,
                                5853,
                                4487,
                                9377,
                                4519,
                                12033,
                                7626,
                                1217,
                                1868,
                                4746,
                                5226,
                                4648,
                                85,
                                2343,
                                94,
                                10103,
                                6130,
                                4849,
                                7761,
                                5171,
                                3099,
                                11592,
                                944,
                                4323,
                                6821,
                                3532,
                                8578,
                                12110,
                                11445,
                                11873,
                                6462,
                                3659,
                                9082,
                                4066,
                                4830,
                                7000,
                                12183,
                                11450,
                                7848,
                                9320,
                                6032,
                                10465,
                                1351,
                                9566,
                                370,
                                2149,
                                2460,
                                5265,
                                11862,
                                3971,
                                12150,
                                10432,
                                1563,
                                11553,
                                11992,
                                8941,
                                1116,
                                883,
                                467,
                                10120,
                                1732,
                                2086,
                                8611,
                                8476,
                                9522,
                                3833,
                                6018,
                                7111,
                                989,
                                6749,
                                556,
                                5772,
                                5067,
                                5184,
                                3512,
                                11668,
                                9239,
                                3480,
                                8355,
                                8330,
                                1086,
                                8320,
                                8604,
                                6562,
                                6868,
                                10534,
                                6687,
                                969,
                                11456,
                                7959,
                                7614,
                                6407,
                                3339,
                                6449,
                                5239,
                                1375,
                                3342,
                                7281,
                                4574,
                                2247,
                                2684,
                                4873,
                                3227,
                                3282,
                                5422,
                                1460,
                                10802,
                                1124,
                                4311,
                                11594,
                                12120,
                                7274,
                                9675,
                                2516,
                                7838,
                                8498,
                                4075,
                                25,
                                12181,
                                2869,
                                857,
                                7246,
                                8894,
                                7212,
                                2842,
                                4287,
                                776,
                                3642,
                                8968,
                                823,
                                7249,
                                10346,
                                7888,
                                6910,
                                6223,
                                9485,
                                9786,
                                3894,
                                3165,
                                5871,
                                7940,
                                4626,
                                4213,
                                6730,
                                8089,
                                1309,
                                793,
                                9983,
                                523,
                                4320,
                                7609,
                                4826,
                                2367,
                                2086,
                                10711,
                                3094,
                                8493,
                                10061,
                                2473,
                                6351,
                                7519,
                                3805,
                                3672,
                                7514,
                                6009,
                                760,
                                3961,
                                7488,
                                4338,
                                5120,
                                1514 });
                int[] b = nh.generate256Bits();
                long[] coer_r = new long[1024];
                for (int i = 0; i < 1024; i++) {
                        coer_r[i] = nh.random.nextLong((long) q);
                }
                Polynomial rival = new Polynomial(coer_r);
                int[] decodea = new int[256];
                int[] decodeb = new int[256];
                int[] decoder = new int[256];
                for (int i = 0; i < b.length; i++) {
                        logger.info("Bit " + i + "\n");
                        float[] paramHint = new float[] {
                                        r / q * ((float) Kb.GetCoef()[i] + (float) .5f * b[i]),
                                        r / q * ((float) Kb.GetCoef()[i + 256] + (float) .5f * b[i]),
                                        r / q * ((float) Kb.GetCoef()[i + 512] + (float) .5f * b[i]),
                                        r / q * ((float) Kb.GetCoef()[i + 768] + (float) .5f * b[i])
                        };
                        logger.info(String.format(Locale.US,
                                        "Entrada CVP: b = %d  x = (%5f, %5f, %5f, %5f)\n", b[i],
                                        paramHint[0],
                                        paramHint[1],
                                        paramHint[2],
                                        paramHint[3]));
                        int[] CVP = nh.CVP(paramHint, (int) r);
                        float error1 = 0;
                        float errorinf = 0;
                        logger.info(String.format(Locale.US, "B*CVP = ( %f, %f, %f, %f) \n", (CVP[0] + 0.5f * CVP[3]),
                                        (CVP[1] + 0.5f * CVP[3]), (CVP[2] + 0.5f * CVP[3]), (CVP[3] * .5f)));
                        for (int j = 0; j < paramHint.length - 1; j++) {
                                error1 = error1 + Math.abs(paramHint[j] - (CVP[j] + 0.5f * CVP[3]));
                                errorinf = Math.max(errorinf, Math.abs(paramHint[j] - (CVP[j] + 0.5f * CVP[3])));
                        }
                        error1 = error1 + Math.abs(paramHint[3] - (CVP[3] * .5f));
                        errorinf = Math.max(errorinf, Math.abs(paramHint[3] - (CVP[3] * .5f)));
                        logger.info(String.format(Locale.US,
                                        "CVP:(%d, %d, %d, %d)    ||e||1 = %f ||e||Inf = %f\n \n", CVP[0],
                                        CVP[1], CVP[2],
                                        CVP[3], error1, errorinf));
                        long[] coef_a = new long[] { Ka.GetCoef()[i],
                                        Ka.GetCoef()[i + 256],
                                        Ka.GetCoef()[i + 512],
                                        Ka.GetCoef()[i + 768]
                        };
                        long[] coef_b = new long[] { Kb.GetCoef()[i],
                                        Kb.GetCoef()[i + 256],
                                        Kb.GetCoef()[i + 512],
                                        Kb.GetCoef()[i + 768]
                        };
                        logger.info("Alice:                                                 Bob:\n");

                        logger.info(String.format(
                                        "Coef:(%5d, %5d, %5d, %5d)                      Coef:(%5d, %5d, %5d, %5d)\n",
                                        coef_a[0],
                                        coef_a[1],
                                        coef_a[2],
                                        coef_a[3],
                                        coef_b[0],
                                        coef_b[1],
                                        coef_b[2],
                                        coef_b[3]));
                        for (int j = 0; j < CVP.length; j++) {
                                CVP[j] = (int) (((CVP[j] % r) + r) % r);
                        }

                        float[] decode_a = new float[] {
                                        (float) Ka.GetCoef()[i] / q - .25f * (CVP[0] + .5f * CVP[3]),
                                        (float) Ka.GetCoef()[i + 256] / q - .25f * (CVP[1] + .5f * CVP[3]),
                                        (float) Ka.GetCoef()[i + 512] / q - .25f * (CVP[2] + .5f * CVP[3]),
                                        (float) Ka.GetCoef()[i + 768] / q - CVP[3] * .5f * .25f
                        };
                        float[] decode_b = new float[] {
                                        (float) Kb.GetCoef()[i] / q - .25f * (CVP[0] + .5f * CVP[3]),
                                        (float) Kb.GetCoef()[i + 256] / q - .25f * (CVP[1] + .5f * CVP[3]),
                                        (float) Kb.GetCoef()[i + 512] / q - .25f * (CVP[2] + .5f * CVP[3]),
                                        (float) Kb.GetCoef()[i + 768] / q - CVP[3] * .5f * .25f
                        };

                        logger.info(String.format(Locale.US,
                                        "deco:(%5f, %5f, %5f, %5f)        deco:(%5f, %5f, %5f, %5f)\n",
                                        decode_a[0],
                                        decode_a[1],
                                        decode_a[2],
                                        decode_a[3],
                                        decode_b[0],
                                        decode_b[1],
                                        decode_b[2],
                                        decode_b[3]));
                        decodea[i] = nh.Decode(decode_a, true);
                        decodeb[i] = nh.Decode(decode_b, true);
                        decoder[i] = nh.Decode(new float[] {
                                        (float) rival.GetCoef()[i] / q
                                                        - .25f * (CVP[0] + .5f * CVP[3]),
                                        (float) rival.GetCoef()[i + 256] / q
                                                        - .25f * (CVP[1] + .5f * CVP[3]),
                                        (float) rival.GetCoef()[i + 512] / q
                                                        - .25f * (CVP[2] + .5f * CVP[3]),
                                        (float) rival.GetCoef()[i + 768] / q
                                                        - CVP[3] * .5f * .25f },
                                        false);
                        logger.info(String.format(Locale.US,
                                        "\nDecode: %d                                              Decode: %d  \n",
                                        decodea[i], decodeb[i]));
                        float error = Math.abs(1f / q * (coef_a[0] - coef_b[0])) +
                                        Math.abs(1f / q * (coef_a[1] - coef_b[1])) +
                                        Math.abs(1f / q * (coef_a[2] - coef_b[2])) +
                                        Math.abs(1f / q * (coef_a[3] - coef_b[3]));

                        logger.info(String.format(Locale.US, "Error: ||x - x'||1 = %f \n", error));
                        logger.info("\n");
                        logger.info("\n");
                }

                logger.info("Clave secreta de A:\n");
                for (int j : decodea) {
                        logger.info(String.format("%d ", j));
                }
                logger.info("\n");
                logger.info("Clave secreta de B:\n");
                for (int j : decodeb) {
                        logger.info(String.format("%d ", j));
                }
                logger.info("\n");
                logger.info("Clave secreta de rival:\n");
                for (int j : decoder) {
                        logger.info(String.format("%d ", j));
                }
                logger.info("\n");

                long finish = System.currentTimeMillis();
                System.out.println((finish - start) + " milisegundos");
                System.out.println();
                if (Arrays.equals(decodea, decodeb) && !Arrays.equals(decodea, decoder)) {
                        System.out.println("Succes");
                } else {

                        System.out.println("Fail");
                }
        }
}
